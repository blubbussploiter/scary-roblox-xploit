#include "communication.h"
#include "..\output.h"

ExploitHandler* ExploitHandler::self = new ExploitHandler();

void ExploitHandler::step()
{
	int r;
	char buffer[100000];

	if (s)
	{
		c = s->connect_client();
		if ((r = c->sync_rec(buffer, 100000)) > 0)
		{
			buffer[r] = '\0';
			try
			{
				scripts.push(buffer);
			}
			catch (exception ex)
			{
				output::printf("[comm_ex]: %s\n", ex.what());
			}
		}
	}
}

void ExploitHandler::close()
{
	if (s)
	{
		s->disconnect();
		delete s;
	}
}

ExploitHandler* ExploitHandler::get()
{
	if (!self)
	{
		self = new ExploitHandler();
	}
	return self;
}
